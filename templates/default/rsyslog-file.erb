# Generated by Chef
# Tail and pipe given log file into Logentries

$ModLoad imfile
$InputFileName <%= @log_file %>
$InputFileTag <%= @tag %>:
$InputFileStateFile stat-<%= @tag %>
$InputFileSeverity <%= @severity %>
$InputRunFileMonitor

$InputFilePollInterval <%= @poll_interval %>

<%- if node['logentries']['enable_tls'] -%>
$DefaultNetstreamDriverCAFile /etc/syslog.logentries.crt # trust these CAs
$ActionSendStreamDriver gtls # use gtls netstream driver
$ActionSendStreamDriverMode 1 # require TLS
$ActionSendStreamDriverAuthMode x509/name # authenticate by hostname
<% end %>
$ActionResumeRetryCount <%= node['logentries']['resume_retry_count'] %>
$ActionQueueType LinkedList # use asynchronous processing
$ActionQueueFileName /var/log/rsyslog_queue_<%= @tag %> # set file name, also enables disk mode
$ActionQueueMaxDiskSpace <%= node['logentries']['queue_disk_space'] %>
if $programname == '<%= @tag %>' then @@logs.logentriesapp.com:<%= node['logentries']['port'] %>;LogentriesFormat
& ~